package com.example.order.kafka; import com.example.order.model.OrderEntity; import com.example.order.repo.OrderRepository; import org.springframework.kafka.annotation.KafkaListener; import org.springframework.stereotype.Service; import com.fasterxml.jackson.databind.ObjectMapper; import java.util.Map; @Service public class OrderConsumer { private final OrderRepository repo; private final ObjectMapper mapper=new ObjectMapper(); public OrderConsumer(OrderRepository repo){ this.repo=repo; } @KafkaListener(topics = "product-orders", groupId = "order-group") public void listen(String message) throws Exception{ Map<String,Object> m=mapper.readValue(message,Map.class); Long pid=Long.valueOf(String.valueOf(m.get("productId"))); String name=String.valueOf(m.get("name")); Double price=Double.valueOf(String.valueOf(m.get("price"))); OrderEntity o=new OrderEntity(pid,name,price,"CREATED"); repo.save(o); System.out.println("Order saved from kafka: " + o.getId()); } }
